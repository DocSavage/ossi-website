---
import "../../styles/tailwind.css";

import { getCollection, getEntries } from "astro:content";

import BaseLayout from "../../layouts/BaseLayout.astro";
import Hero from "../../components/Hero.astro";
import ToggleFilterMenuBtn from "../../components/projects/ToggleFilterMenuBtn.jsx";
import FilterMenu from "../../components/projects/FilterMenu.jsx";
import CardDisplay from "../../components/projects/CardDisplay.jsx";

import { extractUniqueTags } from "../../utils/tagManipulation.js";

const baseUrl = import.meta.env.BASE_URL;

const pageTitle = "OSSI-supported projects";
const allEcosystems = await getCollection("ecosystems");
const allRelatedProjects = await Promise.all(
  allEcosystems.flatMap(async (ecosystem) => {
    const relatedProjects = await getEntries(
      ecosystem.data["related projects"]
    );
    return relatedProjects;
  })
);
const flattenedRelatedProjects = [].concat(...allRelatedProjects);
const uniqueTags = extractUniqueTags(flattenedRelatedProjects);
---

<BaseLayout pageTitle={pageTitle}>
  <Hero>
    <Fragment slot="title">Ecosystems</Fragment>
    <Fragment slot="subtitle">
      Tagline describing what "ecosystems" are
    </Fragment>
  </Hero>

  <section class="px-6 md:py-12 lg:py-20 mx-auto max-w-6xl">
    <div class="flex py-6 md:p-0">
      <ToggleFilterMenuBtn client:load />
    </div>
    <section class="md:grid grid-cols-3 gap-4">
      <FilterMenu client:load key="FilterMenu" uniqueTags={uniqueTags} />
      <CardDisplay
        client:load
        key="CardDisplay"
        allContent={allEcosystems}
        baseUrl={baseUrl}
        contentType="ecosystems"
      />
    </section>
  </section>
</BaseLayout>
