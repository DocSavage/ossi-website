---
import "../../styles/tailwind.css";

import { getCollection, getEntries } from "astro:content";

import BaseLayout from "../../layouts/BaseLayout.astro";
import Hero from "../../components/Hero.astro";
import CardsAndFilters from "../../components/projects/CardsAndFilters.jsx";

import { extractUniqueTags } from "../../utils/tagManipulation.js";

const baseUrl = import.meta.env.BASE_URL;

const pageTitle = "OSSI-supported projects";
const allEcosystems = await getCollection("ecosystems");
const allRelatedProjects = await Promise.all(
  allEcosystems.map(async (ecosystem) => {
    const relatedProjects = await getEntries(
      ecosystem.data["related projects"]
    );
    ecosystem.data.tagsArray = Object.values(
      extractUniqueTags(relatedProjects)
    ).flat();
    return relatedProjects;
  })
);
const uniqueTags = extractUniqueTags(allRelatedProjects[0]);
---

<BaseLayout pageTitle={pageTitle}>
  <Hero>
    <Fragment slot="title">Ecosystems</Fragment>
    <Fragment slot="subtitle">
      Tagline describing what "ecosystems" are
    </Fragment>
  </Hero>
  <CardsAndFilters
    client:load
    uniqueTags={uniqueTags}
    allContent={allEcosystems}
    baseUrl={baseUrl}
    contentType="ecosystems"
  />
</BaseLayout>
